<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>At Work Systems</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="./css/styles.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/flag-icons@6.6.6/css/flag-icons.min.css" rel="stylesheet"/>
    <script src="./js/i18n.js" defer></script>
    <script src="./js/components.js" defer></script>
</head>
<body>
<div id="navbar"></div>

<div class="container-fluid wrapper">
    <div class="main-nav d-flex justify-content-center align-items-center bg-light border-bottom">
        <div class="nav-card" data-section="sales"><i class="fas fa-shopping-cart me-1"></i> <span data-i18n="sales.title">Sales</span></div>
        <div class="nav-card" data-section="purchasing"><i class="fas fa-cart-plus me-1"></i> <span data-i18n="purchasing.title">Purchasing</span></div>
        <div class="nav-card" data-section="production"><i class="fas fa-industry me-1"></i> <span data-i18n="production.title">Production</span></div>
        <div class="nav-card" data-section="resources"><i class="fas fa-cubes me-1"></i> <span data-i18n="resources.title">Resources</span></div>
        <div class="nav-card" data-section="inventory"><i class="fas fa-warehouse me-1"></i> <span data-i18n="inventory.title">Inventory</span></div>
        <div class="nav-card" data-section="personnel"><i class="fas fa-users me-1"></i> <span data-i18n="personnel.title">Personnel</span></div>
    </div>

    <div class="row flex-grow-1">
        <div class="col-md-2 sidebar p-2">
            <div id="sidebar-content" class="sidebar-content"></div>
        </div>
        <div class="col-md-10 main-content p-3">
            <div class="container">
                <div id="main-content-area"></div>
            </div>
        </div>
    </div>
</div>

<div id="footer"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const sections = {
        sales: {
            title: 'sales.title',
            subsections: {
                marketing: { title: 'sales.marketing.title', file: '/content/sales/marketing.html' },
                prospects: { title: 'sales.prospects.title', file: '/content/sales/prospects.html' },
                crm: { title: 'sales.crm.title', file: '/content/sales/crm.html' },
                inquiry: { title: 'sales.inquiry.title', file: '/content/sales/inquiry.html' },
                offers: { title: 'sales.offers.title', file: '/content/sales/offers.html' },
                kpi: { title: 'sales.kpi.title', file: '/content/sales/kpi.html' },
                orders: { title: 'sales.orders.title', file: '/content/sales/orders.html' },
                contact: { title: 'sales.contact.title', file: '/content/sales/contact.html' }
            }
        },
        purchasing: {
            title: 'purchasing.title',
            subsections: {
                audits: { title: 'purchasing.audits.title', file: '/content/purchasing/audits.html' },
                orders: { title: 'purchasing.orders.title', file: '/content/purchasing/orders.html' },
                confirmation: { title: 'purchasing.confirmation.title', file: '/content/purchasing/confirmation.html' },
                suppliers: { title: 'purchasing.suppliers.title', file: '/content/purchasing/suppliers.html' },
                misc: { title: 'purchasing.misc.title', file: '/content/purchasing/misc.html' },
                kpi: { title: 'purchasing.kpi.title', file: '/content/purchasing/kpi.html' }
            }
        },
        production: {
            title: 'production.title',
            subsections: {
                projects: { title: 'production.projects.title', file: '/content/production/projects.html' },
                hse: { title: 'production.hse.title', file: '/content/production/hse.html' },
                kpi: { title: 'production.kpi.title', file: '/content/production/kpi.html' },
                surveys: { title: 'production.surveys.title', file: '/content/production/surveys.html' },
                transport: { title: 'production.transport.title', file: '/content/production/transport.html' }
            }
        },
        resources: {
            title: 'resources.title',
            subsections: {
                planning: { title: 'resources.planning.title', file: '/content/resources/planning.html' },
                vehicles: { title: 'resources.vehicles.title', file: '/content/resources/vehicles.html' },
                properties: { title: 'resources.properties.title', file: '/content/resources/properties.html' }
            }
        },
        inventory: {
            title: 'inventory.title',
            subsections: {
                goods: { title: 'inventory.goods.title', file: '/content/inventory/goods.html' },
                receipt: { title: 'inventory.receipt.title', file: '/content/inventory/receipt.html' },
                freight: { title: 'inventory.freight.title', file: '/content/inventory/freight.html' },
                picklist: { title: 'inventory.picklist.title', file: '/content/inventory/picklist.html' },
                overview: { title: 'inventory.overview.title', file: '/content/inventory/overview.html' }
            }
        },
        personnel: {
            title: 'personnel.title',
            subsections: {
                time: { title: 'personnel.time.title', file: '/content/personnel/time.html' },
                logbook: { title: 'personnel.logbook.title', file: '/content/personnel/logbook.html' },
                employees: { title: 'personnel.employees.title', file: '/content/personnel/employees.html' },
                kpi: { title: 'personnel.kpi.title', file: '/content/personnel/kpi.html' },
                todo: { title: 'personnel.todo.title', file: '/content/personnel/todo.html' }
            }
        }
    };

    function updateSidebarAndContent(sectionKey) {
        const section = sections[sectionKey];
        if (!section) return;

        const sidebarContent = document.getElementById('sidebar-content');
        const mainContent = document.getElementById('main-content-area');

        sidebarContent.innerHTML = `
        <h4 data-i18n="${section.title}"></h4>
        <div class="d-flex flex-column gap-1">
          ${Object.entries(section.subsections).map(([key, val]) => `
            <button class="btn btn-subsection" data-subsection="${key}" data-i18n="${val.title}"></button>
          `).join('')}
        </div>
      `;
        mainContent.innerHTML = `
        <div class="row animate__animated animate__fadeIn" id="${sectionKey}-content">
          <div class="col-md-12">
            <h2 data-i18n="${section.title}"></h2>
            <p>Select a subsection to view details.</p>
          </div>
        </div>
      `;

        i18n.applyTranslations();

        const buttons = sidebarContent.querySelectorAll('.btn-subsection');
        buttons.forEach(button => {
            button.addEventListener('click', () => {
                const key = button.getAttribute('data-subsection');
                const subsection = section.subsections[key];
                fetch(subsection.file)
                    .then(r => r.text())
                    .then(html => {
                        mainContent.innerHTML = `
                <div class="row animate__animated animate__fadeIn">
                  <div class="col-md-12">
                    <h2 data-i18n="${subsection.title}"></h2>
                    ${html}
                  </div>
                </div>
              `;
                        i18n.applyTranslations();
                    });
                buttons.forEach(b => b.classList.remove('active'));
                button.classList.add('active');
            });
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        const savedLang = localStorage.getItem('lang') || 'nob';
        i18n.loadLanguage(savedLang).then(() => {
            return Promise.all([
                loadComponent("/components.html", "#navbar", "nav"),
                loadComponent("/components.html", "#footer", "footer")
            ]);
        }).then(() => {
            const navCards = document.querySelectorAll('.nav-card');
            navCards.forEach(card => {
                card.addEventListener('click', () => {
                    const section = card.getAttribute('data-section');
                    updateSidebarAndContent(section);
                    navCards.forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                });
            });
            if (navCards.length > 0) navCards[0].click();
        });
    });
</script>
</body>
</html>
