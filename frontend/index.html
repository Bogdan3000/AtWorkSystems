<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>At Work Systems</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/styles.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/flag-icons@6.6.6/css/flag-icons.min.css" rel="stylesheet">
    <script src="/js/navbar-and-footer.js"></script>
</head>
<body>
<!-- Top Navigation -->
<div id="navbar"></div>

<!-- Main Layout -->
<div class="container-fluid wrapper">
    <!-- Main Navigation Cards Below Header -->
    <div class="main-nav d-flex justify-content-center align-items-center bg-light border-bottom">
        <div class="nav-card" data-section="salg">
            <i class="fas fa-shopping-cart me-1"></i>
            <span data-i18n="salg">Salg</span>
        </div>
        <div class="nav-card" data-section="innkjop">
            <i class="fas fa-cart-plus me-1"></i>
            <span data-i18n="innkjop">Innkjøp</span>
        </div>
        <div class="nav-card" data-section="produksjon">
            <i class="fas fa-industry me-1"></i>
            <span data-i18n="produksjon">Produksjon</span>
        </div>
        <div class="nav-card" data-section="ressurser">
            <i class="fas fa-cubes me-1"></i>
            <span data-i18n="ressurser">Ressurser</span>
        </div>
        <div class="nav-card" data-section="lager">
            <i class="fas fa-warehouse me-1"></i>
            <span data-i18n="lager">Lager</span>
        </div>
        <div class="nav-card" data-section="personel">
            <i class="fas fa-users me-1"></i>
            <span data-i18n="personel">Personel</span>
        </div>
    </div>

    <div class="row flex-grow-1">
        <!-- Left Sidebar for Subsections -->
        <div class="col-md-2 sidebar p-2">
            <div id="sidebar-content" class="sidebar-content">
                <!-- Dynamic content will be inserted here -->
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="col-md-10 main-content p-3">
            <div class="container">
                <div id="main-content-area">
                    <div class="row" id="salg-content">
                        <div class="col-md-12">
                            <h2 data-i18n="salg">Salg</h2>
                            <p data-i18n="salg_description"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<div id="footer"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        let translations = {};
        let currentLang = localStorage.getItem('language') || 'nob'; // Default to Norwegian

        // Function to load translations
        const loadTranslations = async (lang) => {
            try {
                const response = await fetch(`/lang/${lang}.json`);
                translations = await response.json();
                applyTranslations();
            } catch (error) {
                console.error('Error loading translations:', error);
            }
        };

        // Function to apply translations to the DOM
        const applyTranslations = () => {
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[key]) {
                    element.textContent = translations[key];
                }
            });
            // Update HTML lang attribute
            document.documentElement.lang = currentLang === 'nob' ? 'no' : currentLang;
        };

        // Function to update sidebar and main content
        const updateSidebarAndContent = (section) => {
            const { title, description, subsections } = sections[section];

            // Update sidebar with subsection buttons
            sidebarContent.innerHTML = `
                <h4 data-i18n="${title}">${translations[title]}</h4>
                <p data-i18n="${description}">${translations[description]}</p>
                <div class="d-flex flex-column gap-1">
                    ${Object.entries(subsections).map(([key, value]) => `
                        <button class="btn btn-subsection" data-subsection="${key}">
                            <i class="fas ${value.icon} me-1"></i>
                            <span data-i18n="subsection_${key}">${translations[`subsection_${key}`] || value.title}</span>
                        </button>
                    `).join('')}
                </div>
            `;

            // Update main content with section description initially
            mainContentArea.innerHTML = `
                <div class="row animate__animated animate__fadeIn" id="${section}-content">
                    <div class="col-md-12">
                        <h2 data-i18n="${title}">${translations[title]}</h2>
                        <p data-i18n="${description}">${translations[description]}</p>
                    </div>
                </div>
            `;

            // Add click listeners to subsection buttons
            const subsectionButtons = sidebarContent.querySelectorAll('.btn-subsection');
            subsectionButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const subsectionKey = btn.getAttribute('data-subsection');
                    const subsection = subsections[subsectionKey];
                    mainContentArea.innerHTML = `
                        <div class="row animate__animated animate__fadeIn" id="${subsectionKey}-content">
                            <div class="col-md-12">
                                <h2 data-i18n="subsection_${subsectionKey}">${translations[`subsection_${subsectionKey}`]}</h2>
                                <p data-i18n="subsection_${subsectionKey}_description">${translations[`subsection_${subsectionKey}_description`]}</p>
                            </div>
                        </div>
                    `;
                    subsectionButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    applyTranslations();
                });
            });

            applyTranslations();
        };

        const sections = {
            salg: {
                title: 'salg',
                description: 'salg_description',
                subsections: {
                    markedsforing: { title: 'Markedsføring', icon: 'fa-bullhorn' },
                    prospekter: { title: 'Prospekter', icon: 'fa-address-book' },
                    crm: { title: 'CRM', icon: 'fa-users-cog' },
                    foresporsel: { title: 'Forespørsel', icon: 'fa-question-circle' },
                    tilbud: { title: 'Tilbud', icon: 'fa-file-invoice' },
                    kpiSales: { title: 'KPI Sales', icon: 'fa-chart-line' },
                    salgordre: { title: 'Salgordre', icon: 'fa-shopping-bag' },
                    kundekontakt: { title: 'Kundekontakt', icon: 'fa-phone' }
                }
            },
            innkjop: {
                title: 'innkjop',
                description: 'innkjop_description',
                subsections: {
                    revisjoner: { title: 'Revisjoner', icon: 'fa-search' },
                    innkjopsordre: { title: 'Innkjøpsordre', icon: 'fa-file-alt' },
                    ordrebekreftelse: { title: 'Ordrebekreftelse', icon: 'fa-check-circle' },
                    leverandorforhold: { title: 'Leverandørforhold', icon: 'fa-handshake' },
                    diversebilag: { title: 'Diversebilag', icon: 'fa-folder-open' },
                    kpiInnkjoo: { title: 'KPI Innkjøp', icon: 'fa-chart-bar' }
                }
            },
            produksjon: {
                title: 'produksjon',
                description: 'produksjon_description',
                subsections: {
                    prosjekter: { title: 'Prosjekter', icon: 'fa-project-diagram' },
                    hms: { title: 'HMS', icon: 'fa-shield-alt' },
                    kpiProduksjon: { title: 'KPI Produksjon', icon: 'fa-tachometer-alt' },
                    undersokelser: { title: 'Undersøkelser', icon: 'fa-clipboard-check' },
                    transport: { title: 'Transport', icon: 'fa-truck' }
                }
            },
            ressurser: {
                title: 'ressurser',
                description: 'ressurser_description',
                subsections: {
                    resourcePlanning: { title: 'Resource Planning', icon: 'fa-calendar-alt' },
                    biler: { title: 'Biler', icon: 'fa-car' },
                    eiendommer: { title: 'Eiendommer', icon: 'fa-building' }
                }
            },
            lager: {
                title: 'lager',
                description: 'lager_description',
                subsections: {
                    varer: { title: 'Varer', icon: 'fa-boxes' },
                    varemottak: { title: 'Varemottak', icon: 'fa-truck-loading' },
                    fraktbrev: { title: 'Fraktbrev', icon: 'fa-file-alt' },
                    plukkliste: { title: 'Plukkliste', icon: 'fa-clipboard-list' },
                    lager: { title: 'Lager', icon: 'fa-warehouse' }
                }
            },
            personel: {
                title: 'personel',
                description: 'personel_description',
                subsections: {
                    tidrapportering: { title: 'Tidrapportering', icon: 'fa-clock' },
                    kjorebok: { title: 'Kjorebok', icon: 'fa-road' },
                    ansatte: { title: 'Ansatte', icon: 'fa-users' },
                    kpiTid: { title: 'KPI Tid', icon: 'fa-stopwatch' },
                    todoList: { title: 'Todo List', icon: 'fa-tasks' }
                }
            }
        };

        const navCards = document.querySelectorAll('.nav-card');
        const sidebarContent = document.getElementById('sidebar-content');
        const mainContentArea = document.getElementById('main-content-area');

        navCards.forEach(card => {
            card.addEventListener('click', () => {
                const section = card.getAttribute('data-section');
                updateSidebarAndContent(section);
                navCards.forEach(c => c.classList.remove('active'));
                card.classList.add('active');
            });
        });

        // Language selection handler
        document.addEventListener('click', (e) => {
            if (e.target.closest('.language-select')) {
                e.preventDefault();
                const lang = e.target.closest('.language-select').getAttribute('data-lang');
                localStorage.setItem('language', lang);
                currentLang = lang;
                loadTranslations(lang);
                updateSidebarAndContent(document.querySelector('.nav-card.active')?.getAttribute('data-section') || 'salg');
            }
        });

        // Load initial translations
        loadTranslations(currentLang);

        // Trigger first section on load
        navCards[0].click();
    });
</script>
</body>
</html>